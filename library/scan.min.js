const fs=require("fs"),path=require("path"),getAllFiles=function(dirPath,arrayOfFiles){let files=fs.readdirSync(dirPath);return arrayOfFiles=arrayOfFiles||[],files.forEach((function(file){fs.statSync(dirPath+"/"+file).isDirectory()?arrayOfFiles=getAllFiles(dirPath+"/"+file,arrayOfFiles):arrayOfFiles.push([file,path.join(__dirname,dirPath,"/",file)])})),arrayOfFiles},structure=JSON.parse(fs.readFileSync("./structure.json"));structure.activitiesNumber=0;for(let niveau in structure){structure[niveau].activitiesNumber=0;for(let theme in structure[niveau].themes)for(let chapter in structure[niveau].themes[theme].chapitres)structure[niveau].themes[theme].chapitres[chapter]={n:structure[niveau].themes[theme].chapitres[chapter],e:[]}}for(let niveau in structure){if("activitiesNumber"===niveau)continue;let listOfFiles;getAllFiles("./N"+niveau).forEach((function(fichierExo){let json=JSON.parse(fs.readFileSync(fichierExo[1])),exo={u:"N"+niveau+"/"+fichierExo[0],t:json.title};structure.activitiesNumber++;for(let i in json.dest){let codechap=json.dest[i],destLevel=codechap.match(/(^\d+|T)/i)[0],themecode=codechap.match(/^(\d+|T)[A-Z]/i)[0];void 0!==structure[destLevel]&&(structure[destLevel].activitiesNumber++,structure[destLevel].themes[themecode].chapitres[codechap].e.push(exo))}}))}let data=JSON.stringify(structure);fs.writeFileSync("content.json",data);