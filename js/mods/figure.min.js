import utils from"./utils.js";export default class Figure{constructor(obj,id,target,size){this.type=obj.type,this.content=obj.content,this.boundingbox=obj.boundingbox,this.axis=obj.axis,this.grid=obj.grid,this.id=id,this.keepAspect=void 0===obj.keepAspect||obj.keepAspect,this.size=size,this.imgSrc=obj.imgSrc||!1,this.figure=void 0,this.displayed=!1,this.create(target)}create(destination){if("chart"===this.type){let div=utils.create("div",{id:"div-dest-canvas-"+this.id}),canvas=document.createElement("canvas");canvas.id=this.id,void 0!==this.size&&(div.style.width=this.size[0]+"px",div.style.height=this.size[1]+"px"),div.appendChild(canvas),destination.appendChild(div)}else if("graph"===this.type){let div=document.createElement("div");div.id=this.id,div.className="jsxbox fig",destination.appendChild(div)}else if("svg"===this.type){let div=document.createElement("div");div.id=this.id,destination.appendChild(div)}}static copyFig(figure,target){return!(!figure instanceof Figure)&&new this(figure,figure.id,target,figure.size)}toggle(){let elt,cln;"chart"===this.type?elt=document.getElementById(this.id).parentNode:"graph"!==this.type&&"svg"!==this.type||(elt=document.getElementById(this.id)),elt.className.indexOf("visible")<0?(utils.addClass(elt,"visible"),this.display()):utils.removeClass(elt,"visible")}display(destination){if(!this.displayed)if(this.displayed=!0,"svg"===this.type){let target;target=void 0===destination?document.getElementById(this.id):destination.document.getElementById(this.id),target.innerHTML=this.content}else if("chart"===this.type){let target;target=void 0===destination?document.getElementById(this.id):destination.document.getElementById(this.id),this.figure=new Chart(target,this.content)}else if("graph"===this.type)try{this.figure=void 0===destination?JXG.JSXGraph.initBoard(this.id,{boundingbox:this.boundingbox,keepaspectratio:this.keepAspect,showNavigation:!1,showCopyright:!1,registerEvents:!1,axis:this.axis,grid:this.grid}):destination.JXG.JSXGraph.initBoard(this.id,{boundingbox:this.boundingbox,keepaspectratio:this.keepAspect,showNavigation:!1,showCopyright:!1,registerEvents:!1,axis:this.axis,grid:this.grid});let content=utils.clone(this.content),elements=[];for(let i=0,len=content.length;i<len;i++){let type=content[i][0],commande=content[i][1],options=!1,reference=!1;if(void 0!==content[i][2]&&(options=content[i][2]),void 0!==content[i][3]&&(reference=elements[content[i][3]],commande.forEach((function(elt,index){"string"==typeof elt&&0===elt.indexOf("ref")&&(commande[index]=elements[Number(elt.substr(3))])}))),"functiongraph"===type){let formule=commande;options?this.figure.create("functiongraph",[function(x){return eval(formule)}],options):this.figure.create("functiongraph",[function(x){return eval(formule)}],{strokeWidth:2})}else"jessiescript"===type?(void 0===this.figure.jc&&(this.figure.jc=new JXG.JessieCode,this.figure.jc.use(this.figure)),this.figure.jc.parse(commande)):["text","point","axis","line","segment","angle","polygon","transform","intersection"].indexOf(type)>-1&&(elements[i]=options?this.figure.create(type,commande,options):this.figure.create(type,commande))}}catch(error){utils.debug("Figure",error,this)}}}