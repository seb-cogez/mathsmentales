import utils from"./utils.js";import sound from"./sound.js";import cart from"./cart.js";import steps from"./steps.js";import Zoom from"./zoom.js";import Figure from"./figure.js";import timer from"./timer.js";import keyBoard from"./keyboard.js";import ficheToPrint from"./fichetoprint.js";import activity from"./activity.js";export{MM as default};const MM={version:7,content:void 0,introType:"321",endType:"nothing",touched:!1,selectedCart:0,seed:"",editedActivity:void 0,slidersOrientation:"",onlineState:"no",carts:[],steps:[],timers:[],figs:{},userAnswers:[[],[],[],[]],slidersNumber:1,faceToFace:"n",colorSelectors:[],colors:[],memory:[],goodAnswers:[],zooms:{},mf:{},keyboards:{},ended:!0,embededIn:!1,setEndType(e){this.endType=e},setIntroType(e){this.introType=e},setOnlineState(e){this.onlineState=e,document.querySelector("input[name='online'][value='"+e+"']").checked=!0},getOnlineState(){this.onlineState=utils.getRadioChecked("online")},editActivity:function(e){e=Number(e),MM.editedActivity=MM.carts[MM.selectedCart].activities[e],MM.setTempo(MM.editedActivity.tempo),MM.setNbq(MM.editedActivity.nbq),MM.carts[MM.selectedCart].editedActivityId=e,MM.carts[MM.selectedCart].display(),MM.editedActivity.display(),document.getElementById("unlinkCart").className="",document.getElementById("addToCart").className="hidden",document.getElementById("removeFromCart").className=""},uneditActivity:function(){document.getElementById("addToCart").className="",document.getElementById("removeFromCart").className="hidden",document.getElementById("unlinkCart").className="hidden"},unlinkActivity:function(){this.uneditActivity(),MM.editedActivity=new activity(utils.clone(MM.editedActivity)),MM.editedActivity.display(),MM.carts[MM.selectedCart].editedActivityId=-1,MM.carts[MM.selectedCart].display()},setTempo:function(e){document.getElementById("tempo-slider").value=e,document.getElementById("tempo-value").innerHTML=e+" s."},setNbq:function(e){document.getElementById("nbq-slider").value=e,document.getElementById("nbq-value").innerHTML=e},resetCarts:function(){let e=new cart(0);MM.carts=[e],MM.setMinimalDisposition(0),MM.steps=[],MM.timers=[],MM.figs={},MM.resetInterface()},resetInterface(){document.getElementById("divcarts").className="hidden",document.getElementById("phantom").className="",document.getElementById("divparams").className="col-2 row-3",utils.checkRadio("direction",this.slidersOrientation),utils.checkRadio("beforeSlider",this.introType),utils.checkRadio("endOfSlideRadio",this.endType),utils.checkRadio("online",this.onlineState),utils.checkRadio("facetoface",this.faceToFace),utils.checkRadio("Enonces",this.slidersNumber)},showCartInterface(){document.getElementById("divcarts").className="row-4",document.getElementById("phantom").className="hidden",document.getElementById("divparams").className="row-3"},addCart:function(){this.uneditActivity();let e=MM.carts.length+1;if(e>4)return!1;MM.carts[e-1]=new cart(e-1),MM.setMinimalDisposition(e-1);let t=utils.create("button");t.value=e,t.className="tabs-menu-link",t.innerHTML='<img src="img/cart'+e+'.png">',t.id="button-cart"+e;let s=document.getElementById("addcart"),i=document.getElementById("cartsMenu"),n=i.removeChild(s);i.appendChild(t).click(),e<4&&i.appendChild(n)},getCartsContent:function(){let e=utils.create("div",{style:"display:flex;"});for(let t=0;t<MM.carts.length;t++){let s=utils.create("ul",{innerHTML:"<span class='bold'>"+MM.carts[t].title+"</span>"}),i=MM.carts[t].activities;for(let e=0;e<i.length;e++){let t=utils.create("li",{innerText:i[e].title});s.appendChild(t)}e.appendChild(s)}return e},restoreCartsInterface:function(){let e=document.getElementById("cartsMenu");e.innerHTML='<button class="tabs-menu-link is-active" value="1" id="button-cart1"><img src="img/cart1.png"></button>\n        <button id="addcart" title="Ajouter un panier"><img src="img/cartadd.png"></button>';for(let t=1;t<this.carts.length;t++){let s=t+1,i=utils.create("button",{value:s,className:"tab-menu-link",innerHTML:'<img src="img/cart'+s+'.png">',id:"button-cart"+s}),n=document.getElementById("addcart"),a=e.removeChild(n);e.appendChild(i),s<4&&e.appendChild(a)}},removeCart:function(e){if(!window.confirm("Vous êtes sur le point de supprimer ce panier.\nConfirmez-vous ?"))return!1;let t=document.getElementById("button-cart"+MM.carts.length),s=document.getElementById("cartsMenu");if(s.removeChild(t),!document.getElementById("addcart")){let e=document.createElement("button");e.id="addcart",e.innerHTML='<img src="img/cartadd.png">',e.onclick=function(){MM.addCart()},s.appendChild(e)}MM.carts.splice(e-1,1),MM.setMinimalDisposition(MM.carts.length-1),MM.showCart(1)},showCart(e){this.uneditActivity(),e=Number(e),MM.selectedCart=e-1;for(let t,s=1,i=MM.carts.length;s<=4;s++){s<=i&&(t=document.getElementById("button-cart"+s));let n=document.getElementById("cart"+(s-1));s!==e?(n.className="hidden",s<=i&&utils.removeClass(t,"is-active")):(n.className="cartcontent",s<=i&&utils.addClass(t,"is-active"))}MM.carts[MM.selectedCart].editedActivityId>-1&&(MM.carts[MM.selectedCart].activities[MM.carts[MM.selectedCart].editedActivityId].display(),this.editActivity(MM.carts[MM.selectedCart].editedActivityId))},emptyCart(e){if(!window.confirm("Vous êtes sur le point de vider ce panier.\nConfirmez-vous ?"))return!1;MM.carts[e-1].activities=[],MM.carts[e-1].editedActivityId=-1,MM.carts[e-1].display()},addToCart(){MM.carts[MM.selectedCart].addActivity(MM.editedActivity),MM.showCartInterface()},removeFromCart(){let e=MM.carts[MM.selectedCart];e.removeActivity(e.editedActivityId),e.editedActivityId=-1,document.getElementById("addToCart").className="",document.getElementById("removeFromCart").className="hidden"},checkLoadedCarts(e=!1){let t=!0;for(const e of this.carts)e.loaded||(t=!1);if(t)if(e)MM.start();else{const e=document.getElementById("tab-accueil");let t='Ce lien mène à une activité Maths et Matic Projector<br>Clique ci-dessous pour démarrer.<br><br><button class="button--primary" id="btn-message-start"> Démarrer le diaporama </button>';1===MM.carts.length&&null===sound.selected&&(t+='<br><br><button class="button--info" id="btn-message-sound">Avec du son</button>'),1===MM.carts.length&&1===MM.carts[0].target.length&&(t+='<br><br> ou <button class="button--success" id="btn-message-interact"> Commencer (interactif)</button>');let s=utils.create("div",{id:"messageinfo",className:"message",innerHTML:t});e.appendChild(s),e.addEventListener("click",(e=>{switch(e.target.id){case"btn-message-start":utils.closeMessage("messageinfo"),MM.start();break;case"btn-message-sound":sound.next();break;case"btn-message-interact":utils.closeMessage("messageinfo"),MM.setOnlineState("yes"),MM.start();break;default:break}}))}else{let e=document.getElementById("messageinfo");null!==e&&(e.innerHTML+="<br><br>Le chargement n'est pas encore terminé. Patience...")}},populateQuestionsAndAnswers(e){void 0===e&&(e=!0),MM.figs={},MM.steps=[],MM.timers=[],MM.memory={},MM.goodAnswers=[];let t=MM.carts.length,s=document.getElementById("enonce-content"),i=document.getElementById("corrige-content");t>1&&(s.className="grid-"+t,i.className="grid-"+t),s.innerHTML="",i.innerHTML="",utils.setSeed(),MM.copyURLtoHistory();for(let e=0;e<t;e++){MM.carts[e].actsArrays=[];for(let t=0,n=MM.carts[e].target.length;t<n;t++){let a=0;MM.goodAnswers[t]=[];let r=MM.carts[e].target[t]-1,d=document.getElementById("slider"+r);void 0!==MM.colors[r]&&(d.style.background=MM.colors[r]);let l="";n>1&&(l="-"+(t+1));let o=MM.carts[e].title+l;document.querySelector("#slider"+r+" .slider-title").innerHTML=o;let c=document.querySelector("#slider"+r+" .steps-container"),M=utils.create("div",{id:"de"+e+"-"+t}),m=utils.create("div",{id:"dc"+e+"-"+t});MM.zooms["zc"+e+"-"+t]=new Zoom("zc"+e+"-"+t,"#dc"+e+"-"+t+" ol",!0),MM.zooms["ze"+e+"-"+t]=new Zoom("ze"+e+"-"+t,"#de"+e+"-"+t+" ol",!0),M.appendChild(MM.zooms["ze"+e+"-"+t].createCursor()),m.appendChild(MM.zooms["zc"+e+"-"+t].createCursor());let u=utils.create("h3",{innerText:o}),p=utils.create("h3",{innerText:o});M.append(u),m.append(p);let g=utils.create("ol"),h=utils.create("ol");void 0!==MM.colors[r]&&(g.style.background=MM.colors[r],h.style.background=MM.colors[r]),MM.steps[r]=new steps({size:0,container:c}),MM.timers[r]=new timer(r);let y=[];for(let s=0,i=MM.carts[e].activities.length;s<i;s++){let i=MM.carts[e].activities[s];i.generate(),MM.goodAnswers[t][s]=utils.clone(i.values),MM.steps[r].addSize(i.nbq);for(let e=0;e<i.questions.length;e++)y.push([s,e])}MM.carts[e].ordered||(y=utils.shuffle(y)),MM.carts[e].actsArrays[t]=y;for(let t=0;t<y.length;t++){let s=MM.carts[e].activities[y[t][0]],i=y[t][1],n=s.questions[i],l=s.answers[i],o=s.textSize||!1,c=t%2?" pair":" impair",M=utils.create("div",{className:"slide w3-animate-top"+(a>0?" hidden":"")+c,id:"slide"+r+"-"+a}),m=utils.create("span",{innerHTML:n});o&&(m.className=o);let u=utils.create("span",{className:"answerInSlide hidden"});Array.isArray(l)?u.innerHTML=l[0]:u.innerHTML=l,o&&(u.className+=" "+o),MM.timers[r].addDuration(s.tempo);let p=utils.create("li",{innerHTML:n}),v=document.createElement("li");void 0!==s.type&&""!==s.type&&"latex"!==s.type||(p.className="math",v.className="math",m.className+=" math",u.className+=" math"),M.appendChild(m),"yes"!==MM.onlineState&&M.appendChild(u),d.appendChild(M),Array.isArray(l)?v.innerHTML+=l[0]:v.innerHTML+=l,void 0!==s.figures[i]&&(v.innerHTML+='&nbsp; <button data-id="c'+r+"-"+a+'">Figure</button>',MM.figs[r+"-"+a]=new Figure(utils.clone(s.figures[i]),"c"+r+"-"+a,M),MM.memory["e"+r+"-"+a]=new Figure(utils.clone(s.figures[i]),"en"+r+"-"+a,p,[300,150]),MM.memory["c"+r+"-"+a]=new Figure(utils.clone(s.figures[i]),"cor"+r+"-"+a,v,[450,225])),g.appendChild(p),h.appendChild(v),a++}M.append(g),m.append(h),s.append(M),i.append(m),MM.steps[r].display(),utils.isEmpty(MM.figs)||setTimeout((function(){for(let e=0;e<a;e++)void 0!==MM.memory["e"+r+"-"+e]&&MM.memory["e"+r+"-"+e].display()}))}}utils.mathRender()},createUserInputs:function(){MM.mf={},MM.keyboards={};for(let e=0,t=MM.carts[0].target.length;e<t;e++)for(let t=0,s=MM.carts[0].actsArrays[e].length;t<s;t++){document.getElementById("slider"+e);const s=document.getElementById("slide"+e+"-"+t),i="ansInput"+e+"-"+t;MM.mf[i]=new MathfieldElement({smartMode:!0,virtualKeyboardMode:"off",fontsDirectory:"../katex/fonts"});let n=MM.carts[0].activities[MM.carts[0].actsArrays[e][t][0]].keys||void 0;MM.keyboards[i]=new keyBoard(MM.mf[i],n,s,e),void 0!==MM.figs[e+"-"+t]&&(MM.mf[i].style.fontSize="0.333em"),MM.mf[i].id=i,MM.mf[i].target=s,MM.mf[i].addEventListener("keyup",(function(t){"Enter"!==t.key&&"NumpadEnter"!==t.code||(MM.nextSlide(e),t.preventDefault())})),s.appendChild(MM.mf[i]),s.appendChild(utils.create("div",{style:"height:270px;"}))}},setFacetoFace(e){this.faceToFace=e,"y"===e?(utils.addClass(document.getElementById("sddiv1"),"return"),MM.slidersNumber>2&&utils.addClass(document.getElementById("sddiv2"),"return")):(utils.removeClass(document.getElementById("sddiv1"),"return"),utils.removeClass(document.getElementById("sddiv2"),"return"))},getFacetoFace(){this.faceToFace=utils.getRadioChecked("facetoface")},createExercicesSheet:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity);let e=!1;document.getElementById("aleaInURL").checked&&(e=!0);let t=this.paramsToURL(e,"exosheet"),s=this.setURL(t,"exosheet");MM.window=window.open(s,"mywindow","location=no,menubar=no,titlebar=no,width=1123")},createExamSheet:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.fiche=new ficheToPrint("exam",MM.carts[0])},createCeintureSheet:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity);let e=0;for(let t=0;t<MM.carts[0].activities.length;t++)e+=Number(MM.carts[0].activities[t].nbq);let t=Number(document.getElementById("ceintcolsval").value)*Number(document.getElementById("ceintrowsval").value);e<t?alert("Pas assez de questions dans le panier pour alimenter la ceinture\nde "+document.getElementById("ceintcolsval").value+"×"+document.getElementById("ceintrowsval").value+"="+t+" emplacements"):e>t&&!confirm("Vous allez créé une ceinture de "+t+" emplacements\nalors que vous avez créé un panier de"+e+"questions.\nToutes ne seront donc pas imprimées. Continuer ?")||(MM.fiche=new ficheToPrint("ceinture",MM.carts[0],utils.getRadioChecked("ceintorientation")))},createFlashCards:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.fiche=new ficheToPrint("flashcard",MM.carts[0])},createWhoGots:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.fiche=new ficheToPrint("whogots",MM.carts[0])},createDominos:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.fiche=new ficheToPrint("dominos",MM.carts[0])},start:function(){if(MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.getOnlineState(),"yes"===MM.onlineState){if(MM.userAnswers=[[],[],[],[]],MM.carts.length>1)for(let e=1,t=MM.carts.length;e<t;e++)delete MM.carts[e];document.querySelector("#slideshow-container > header").className="hidden"}else document.querySelector("#slideshow-container > header").className="";utils.showTab("none"),MM.checkIntro(),MM.createSlideShows(),MM.populateQuestionsAndAnswers(),"321"===MM.introType?(document.getElementById("countdown-container").className="",sound.selected&&(setTimeout((()=>{sound.beeps()}),800),setTimeout((()=>{sound.setSound(sound.selected)}),3500)),setTimeout((function(){document.getElementById("countdown-container").className="hidden","yes"===MM.onlineState&&MM.createUserInputs(),MM.showSlideShows(),MM.startTimers()}),3600)):"example"===MM.introType?(MM.showSampleQuestion(),MM.showSlideShows()):("yes"===MM.onlineState&&MM.createUserInputs(),MM.showSlideShows(),MM.startTimers()),this.ended=!1},paramsToURL(e=!1,t=""){let s=MM.colors.join("~").replace(/\,/g,"_");return"exosheet"===t?"s="+document.getElementById("exTxtSizeValue").value+",n="+document.getElementById("exQtyValue").value+",cor="+utils.getRadioChecked("excorr")+",a="+(e?MM.seed:"")+",t="+(document.getElementById("extitle").value||document.getElementById("extitle").placeholder)+",ex="+(document.getElementById("exeachex").value||document.getElementById("exeachex").placeholder)+this.export():"i="+MM.introType+",e="+MM.endType+",o="+MM.onlineState+",s="+MM.slidersNumber+",so="+MM.slidersOrientation+",f="+MM.faceToFace+",a="+(e?MM.seed:"")+",colors="+s+",snd="+sound.selected+this.export()},copyURL(e=""){const t=document.getElementById("colparameters");let s=utils.create("div",{id:"urlCopy",className:"message",style:"padding:1.5rem",innerHTML:'<div>Adresse longue<div>\n                <textarea readonly="true" id="bigurl" cols="38" onfocus="utils.copy(this);"></textarea><br>\n                <div id="RacID">\n                <button onclick="navigator.clipboard.writeText(document.getElementById(\'bigurl\').value); window.open(\'https://s.42l.fr/\', \'projection\', \'width=1080,height=720\')">Raccourcir cet url</button>\n                <button onclick="window.open(\'https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=\' + document.getElementById(\'bigurl\').value, \'generationQR\', \'width=300,height=300\')">Obtenir un QR Code</button>\n                <p>En raccourcissant l\'url, vous serez redirigé vers https://s.42l.fr/, le lien etant déja copié, il vous suffira de coller l\'url sur le champ dédié<p>\n                </div>\n                <br>\n                <div style="display: none;"><input readonly="true" type="url" id="shorturl" size="38" onfocus="utils.copy(this)">\n                <div id="shortQRdiv"></div><div>\n                '});t.addEventListener("click",(e=>{"btn-urlshorter"===e.target.id&&MM.getQR()})),t.addEventListener("focus",(e=>{["bigurl","shorturl"].indexOf(e.target.id)>-1&&utils.copy(e.target)}));let i=!1;document.getElementById("aleaInURL").checked&&(i=!0);let n=this.paramsToURL(i,e),a=utils.create("button",{innerHTML:"<img src='img/closebutton32.png'>",style:"position:absolute;top:0.5rem;right:0.5rem;padding:0;background:transparent"});a.onclick=()=>{let e=document.getElementById("urlCopy");e.parentNode.removeChild(e)},s.appendChild(a),t.appendChild(s);let r=document.getElementById("bigurl");r.value=this.setURL(n,e),navigator.clipboard.writeText(r.value),r.select(),r.setSelectionRange(0,99999)},copyURLtoHistory(e=""){const t=document.querySelector("#tab-historique ol");let s=this.paramsToURL(!0),i=this.setURL(s,e),n=this.paramsToURL(!1),a=this.setURL(n,e),r=utils.create("li"),d=utils.create("span",{innerText:"Panier du "+utils.getDate()+": ",className:"bold"});r.appendChild(d);const l=utils.create("a",{href:i,innerText:"🎯 lien (mêmes données)"});r.appendChild(l);const o=utils.create("a",{href:a,innerText:"🎯 lien (autres données)"});r.appendChild(o);let c=`\n        <span class="pointer underline" data-url="${i}">🛠 éditer</span>\n        <span class="pointer underline">❌ Supprimer</span>\n        `;r.innerHTML+=c,r.appendChild(this.getCartsContent());let M=document.querySelectorAll("#tab-historique span[data-url='"+i+"']");for(let e=0;e<M.length;e++){let s=M[e].parentNode;t.removeChild(s)}t.prepend(r),window.localStorage&&localStorage.setItem("history",t.innerHTML)},removeFromHistory(e){if(!confirm("Supprimer cet élément : \n"+e.childNodes[0].innerText+" ?"))return!1;document.querySelector("#tab-historique ol").removeChild(e),window.localStorage&&localStorage.setItem("history",document.querySelector("#tab-historique ol").innerHTML)},removeSelectionFromHistory(){const e=document.querySelectorAll("#tab-historique input[class='checkhistoric']:checked");for(let t=e.length-1;t>=0;t--){let s=e[t].parentNode;s.parentNode.removeChild(s)}window.localStorage&&(this.createSelectHistory(),localStorage.setItem("history",document.querySelector("#tab-historique ol").innerHTML),this.createSelectHistory())},createSelectHistory(){if(this.historySelectCreated)this.destroySelectHistory(),document.getElementById("actionsSelectHist").className="hidden";else{this.historySelectCreated=!0;const e=document.querySelectorAll("#tab-historique > ol > li");for(let t=0;t<e.length;t++){let s=utils.create("input",{type:"checkbox",value:t,selected:!1,className:"checkhistoric"});e[t].prepend(s)}document.getElementById("actionsSelectHist").className=""}},destroySelectHistory(){this.historySelectCreated=!1;const e=document.querySelectorAll("#tab-historique > ol > li > input");for(let t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])},emptyHistory(){if(!confirm("Confirmez-vous la suppression de tout l'historique ?"))return!1;document.querySelector("#tab-historique ol").innerHTML="",window.localStorage&&localStorage.setItem("history","")},generatePage(){window.alert("Fonctionalité en cours de développement.")},generateCode(){window.alert("Fonctionnalité en cours de développement")},getQR(){MM.carts.length<2&&MM.carts[0].activities.length<2&&(MM.carts[0].activities=[],MM.carts[0].addActivity(MM.editedActivity));let e=document.getElementById("bigurl").value,t=document.getElementById("shortQRdiv");t.innerHTML="";let s=utils.create("div",{className:"lds-ellipsis",innerHTML:"<div></div><div></div><div></div><div></div>"}),i=utils.create("div",{innerHTML:"Génération en cours"});t.appendChild(s),t.appendChild(i);let n=new XMLHttpRequest;n.onload=function(){t.removeChild(s),t.removeChild(i);let e=n.responseText;if(0!==e.indexOf("http:"))return void t.appendChild(utils.create("h2",{innertext:"Problème de récupération de l'url courte"}));t.appendChild(utils.create("h2",{innerText:"QRcode de l'exercice"}));let a=utils.create("img",{id:"qrious",title:"Clic droit pour copier l'image"});t.appendChild(a);let r=document.getElementById("shorturl");r.value=e,r.select(),r.setSelectionRange(0,99999),document.execCommand("copy");new QRious({element:a,value:e,size:200,padding:12})},n.open("get","getshort.php?url="+encodeURIComponent(e)),n.send()},export(){let e="";MM.carts[0].activities.length<2&&1===MM.carts.length&&(MM.carts[0].activities=[],MM.carts[0].addActivity(MM.editedActivity)),MM.checkIntro(),utils.setSeed();for(let t=0;t<this.carts.length;t++)e+=this.carts[t].export();return e},setURL:(e,t)=>"exosheet"===t?(utils.baseURL.indexOf("index.html")<0&&(utils.baseURL+="index.html"),utils.baseURL.replace("index","exercices")+"?"+e+(MM.embededIn?"&embed="+MM.embededIn:"")):utils.baseURL+"?"+e+(MM.embededIn?"&embed="+MM.embededIn:""),checkIntro:function(){MM.introType=utils.getRadioChecked("beforeSlider"),MM.endType=utils.getRadioChecked("endOfSlideRadio")},startTimers:function(){"yes"!==MM.onlineState||MM.touched||document.getElementById("ansInput0-0").focus();for(let e=0,t=MM.timers.length;e<t;e++)MM.timers[e].start(0)},showSampleQuestion:function(){let e=MM.slidersNumber;utils.setSeed("sample");let t=document.getElementById("slideshow"),s=[];for(let e=0,t=MM.carts.length;e<t;e++){MM.carts[e].activities[0].generateSample();for(let t=0;t<MM.carts[e].target.length;t++)s[MM.carts[e].target[t]-1]=e}let i=utils.create("div",{id:"sampleLayer",className:"sample"});for(let t=0;t<e;t++){let n=utils.create("div",{id:"sample"+t});n.className=1===e?"slider-1":2===e?"slider-2":"slider-34";let a="";MM.carts[s[t]].activities.length>1&&(a=`<button title="Activité suivante du panier" data-actid="0" id="ButtonNextAct${t}"><img src="img/slider-next.png"></button>`),n.innerHTML=`Exemple <div class="slider-nav">\n            <button title="Annoter l'exemple" id="btn-sample-annotate${t}"><img src="img/iconfinder_pencil_1055013.png"></button>\n            <button title="Montrer la réponse" id="btn-sample-showanswer${t}"><img src="img/slider-solution.png"></button>\n            <button title="Autre exemple" id="btn-newsample${t}"><img src="img/newsample.png"></button>\n            ${a}\n            <button title="Démarrer le diaporama" id="btn-sample-start${t}"><img src="img/fusee.png"></button>\n            </div>`;let r=utils.create("div",{className:"slide",id:"sampleSlide"+t}),d=utils.create("span",{id:"sample"+t+"-enonce"}),l=utils.create("span",{id:"sample"+t+"-corr",className:"hidden"});r.appendChild(d),r.appendChild(l),n.appendChild(r),i.appendChild(n)}t.appendChild(i);for(let e=0;e<MM.carts.length;e++)for(let t=0;t<MM.carts[e].target.length;t++){let s=MM.carts[e].target[t]-1,i=MM.carts[e].activities[0];if(document.getElementById("sample"+s+"-enonce").innerHTML=i.sample.question,document.getElementById("sample"+s+"-corr").innerHTML=i.sample.answer,void 0!==i.type&&""!==i.type&&"latex"!==i.type||(document.getElementById("sample"+s+"-enonce").className="math",document.getElementById("sample"+s+"-corr").className+=" math"),void 0!==i.sample.figure){let e=new Figure(utils.clone(i.sample.figure),"sample-c"+s,document.getElementById("sampleSlide"+s));setTimeout((function(){e.display()}),100)}}utils.mathRender()},showQuestions:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.createSlideShows(),MM.populateQuestionsAndAnswers(),utils.showTab(document.querySelector("[numero='#tab-enonce'].tabs-menu-link")),1===MM.carts.length&&1===MM.carts[0].activities.length&&(MM.resetCarts(),MM.editedActivity.display())},showAnswers:function(){MM.carts[0].activities.length||MM.carts[0].addActivity(MM.editedActivity),MM.createSlideShows(),MM.populateQuestionsAndAnswers(),utils.showTab(document.querySelector("[numero='#tab-corrige'].tabs-menu-link")),1===MM.carts.length&&1===MM.carts[0].activities.length&&(MM.resetCarts(),MM.editedActivity.display())},createSlideShows:function(){MM.zooms={},MM.zooms.thezoom=new Zoom("thezoom","#slideshow .slide",!0);let e=document.querySelector("#slideshow-container header"),t=e.querySelector("#thezoom");if(t&&e.removeChild(t),e.appendChild(MM.zooms.thezoom.createCursor()),isNaN(MM.slidersNumber)){let e=0;for(let t=0;t<MM.carts.length;t++)e+=MM.carts[t].target.length;e<5&&(MM.slidersNumber=e)}let s=MM.slidersNumber,i=document.getElementById("slideshow");i.innerHTML="","v"===MM.slidersOrientation?utils.addClass(i,"vertical"):utils.removeClass(i,"vertical"),"y"===MM.faceToFace?utils.addClass(i,"return"):utils.removeClass(i,"return");for(let e=0;e<s;e++){let t=document.createElement("div");t.id="slider"+e,t.className=1===s?"slider-1":2===s?"slider-2":"slider-34";let n=`<div class="slider-head"><div class="slider-nav">\n            <button title="Arrêter le diaporama" id="btn-timer-end${e}"><img alt="Stop" src="img/slider-stop.png"></button>`;"no"===MM.onlineState&&(n+=`<button title="Mettre le diapo en pause", id="btn-timer-pause${e}"><img alt="Pause" src="img/slider-pause.png"></button>\n                <button title="Montrer la réponse" id="btn-show-answer${e}"><img alt="Next" src="img/slider-solution.png"></button>`),MM.zooms["zs"+e]=new Zoom("zs"+e,"#slider"+e+" .slide");let a=MM.zooms["zs"+e].createCursor();n+=`<button title="Passer la diapo" id="btn-next-slide${e}"><img src="img/slider-next.png" /></button>\n            </div>\n            <div class="slider-title"></div>\n            <div class="slider-chrono"><progress class="progress is-link is-large" value="0" max="100"></progress></div></div>\n            <div class="steps-container"></div>`,t.innerHTML=n,t.querySelector(".slider-head").appendChild(a),i.appendChild(t)}},showSlideShows:function(){utils.removeClass(document.getElementById("slideshow-container"),"hidden"),utils.addClass(document.getElementById("app-container"),"hidden"),sound.selected&&sound.play(),utils.isEmpty(MM.figs)||MM.displayFirstFigs()},displayFirstFigs:function(){for(let e=0;e<4;e++)"object"==typeof MM.figs[e+"-0"]&&MM.figs[e+"-0"].display()},hideSlideshows:function(){if(this.ended)return!1;utils.addClass(document.getElementById("slideshow-container"),"hidden"),utils.removeClass(document.getElementById("app-container"),"hidden");let e=utils.getRadioChecked("endOfSlideRadio");if("yes"===MM.onlineState){let e=utils.create("div",{id:"messagefin",className:"message",innerHTML:'L\'activité Maths et Matic Projector est terminée.<br>Pour consulter les résultats, cliquer sur le bouton ci-dessous.<br><br>\n            <button id="btn-messagefin-close"> Voir le corrigé \n            </button>'});document.body.appendChild(e),document.body.addEventListener("click",(e=>{"btn-messagefin-close"===e.target.id&&(utils.closeMessage("messagefin"),utils.showTab("tab-corrige"))}))}else"correction"===e?utils.showTab("tab-corrige"):"list"===e&&utils.showTab("tab-enonce");this.ended=!0},showTheAnswer(e){let t=document.querySelector("#slide"+e+"-"+MM.steps[e].step+" .answerInSlide");t&&(t.className.indexOf("hidden")>-1?(MM.timers[e].pause(),utils.removeClass(t,"hidden")):(utils.addClass(t,"hidden"),MM.timers[e].start()))},showSampleAnswer(e){let t=document.getElementById("sample"+e+"-corr");t.className.indexOf("hidden")>-1?utils.removeClass(t,"hidden"):utils.addClass(t,"hidden")},newSample(e,t=!1){for(let s=0,i=MM.carts.length;s<i;s++)if(MM.carts[s].target.indexOf(e+1)>-1){let i=MM.carts[s].activities.length,n=0;MM.carts[s].activities.length>1&&(n=document.getElementById("ButtonNextAct"+e).dataset.actid,t&&(n++,n>=i&&(n=0),document.getElementById("ButtonNextAct"+e).dataset.actid=n));let a=MM.carts[s].activities[n];if(a.generateSample(),document.getElementById("sample"+e+"-enonce").innerHTML=a.sample.question,document.getElementById("sample"+e+"-corr").innerHTML=a.sample.answer,void 0!==a.type&&""!==a.type&&"latex"!==a.type||(document.getElementById("sample"+e+"-enonce").className="math",document.getElementById("sample"+e+"-corr").className+=" math"),void 0!==a.sample.figure){let t;t="chart"===a.sample.figure.type?document.getElementById("div-dest-canvas-sample-c"+e):document.getElementById("sample-c"+e),t.parentNode.removeChild(t);let s=new Figure(utils.clone(a.sample.figure),"sample-c"+e,document.getElementById("sampleSlide"+e));setTimeout((function(){s.display()}),100)}utils.mathRender()}},removeSample(){let e=document.getElementById("sampleLayer");e.parentNode.removeChild(e)},startSlideShow(){MM.removeSample(),"yes"===MM.onlineState&&MM.createUserInputs(),"yes"!==MM.onlineState||MM.touched||document.getElementById("ansInput0-0").focus(),MM.startTimers()},nextSlide:function(e){"yes"===MM.onlineState&&(MM.userAnswers[e][MM.steps[e].step]=MM.mf["ansInput"+e+"-"+MM.steps[e].step].value);let t=MM.steps[e].nextStep();if(!1===t)return MM.timers[e].end(),!1;1===MM.carts.length&&sound.play(),MM.timers[e].start(t);let s=document.querySelector("#slide"+e+"-"+(t-1)),i=document.querySelector("#slide"+e+"-"+t);utils.addClass(s,"hidden"),i&&(utils.removeClass(i,"hidden"),void 0!==MM.figs[e+"-"+t]&&MM.figs[e+"-"+t].display(),"yes"!==MM.onlineState||MM.touched?"yes"===MM.onlineState&&MM.touched&&MM.mf["ansInput"+e+"-"+t].focus():MM.mf["ansInput"+e+"-"+t].focus())},messageEndSlide:function(e,t){document.querySelectorAll("#slider"+e+" .slide")[t].innerHTML="<span>Fin du diaporama</span>"},endSliders:function(){let e=!0;for(let t=0,s=MM.timers.length;t<s;t++)!1===MM.timers[t].ended&&(e=!1);if(e){if(MM.hideSlideshows(),"yes"===MM.onlineState){let e=document.createElement("div");for(let t=0,s=MM.carts[0].actsArrays.length;t<s;t++){let s=0,i=document.createElement("ol");i.innerHTML="<b>Réponses de "+(t+1)+"</b>";let n=0;for(let e=0,a=MM.carts[0].actsArrays[t].length;e<a;e++){let a=MM.carts[0].actsArrays[t][e],r=document.createElement("li"),d=document.createElement("span"),l=MM.userAnswers[t][n].replace(",",".").trim();0===l.indexOf("\\text")&&(l=l.substring(6,l.length-1)),l=l.replace("\\text{ }"," "),l=l.replace(">","\\gt"),l=l.replace("<","\\lt");const o=MM.goodAnswers[t][a[0]][a[1]];let c=MM.carts[0].activities[a[0]].valueType;if(Array.isArray(o))for(let e=0;e<o.length;e++){if(String(l).toLowerCase()==String(o[e]).toLowerCase()){r.className="good",s++;break}{const t=KAS.parse(o[e]).expr,i=KAS.parse(String(l).replace("²","^2")).expr;try{if(KAS.compare(t,i,{form:!0,simplify:!1}).equal){r.className="good",s++;break}r.className="wrong"}catch(e){r.className="wrong"}}}else if(!1!==c){if("liste"===c){let e=l.split(";").map((e=>e.trim())).sort(((e,t)=>e-t)),t=o.split(";").map((e=>e.trim())).sort(((e,t)=>e-t));e.toString()===t.toString()?(r.className="good",s++):r.className="wrong"}else if("inInterval"===c){let e=o.split("-").map((e=>Number(e)));Number(l)>e[0]&&Number(l)<e[1]?(r.className="good",s++):r.className="wrong"}}else if(String(l).toLowerCase()==String(o).toLowerCase())r.className="good",s++;else{const e=KAS.parse(o).expr,t=KAS.parse(String(l).replace("²","^2")).expr;try{KAS.compare(e,t,{form:!0,simplify:!1}).equal?(r.className="good",s++):r.className="wrong"}catch(e){r.className="wrong"}}d.className="math",l="\\displaystyle "+l,d.textContent=l,n++,r.appendChild(d),i.appendChild(r)}e.appendChild(i);let a=document.createElement("section");a.innerHTML="<b>Score :</b> "+s+"/"+n,e.appendChild(a),MM.embededIn&&window.parent.postMessage({url:window.location.href,graine:MM.seed,nbBonnesReponses:s,nbMauvaisesReponses:parseInt(n)-parseInt(s),slider:t,touchable:MM.touched},MM.embededIn)}document.getElementById("corrige-content").appendChild(e),utils.mathRender()}else MM.embededIn&&window.parent.postMessage({url:window.location.href,graine:MM.seed},MM.embededIn);1===MM.carts.length&&1===MM.carts[0].activities.length&&(MM.resetCarts(),MM.editedActivity.display())}},pauseAllSliders(){if("no"===MM.onlineState)for(let e=0,t=MM.timers.length;e<t;e++)MM.timers[e].pause()},stopAllSliders:function(){for(let e=0,t=MM.timers.length;e<t;e++)MM.timers[e].end()},nextAllSliders:function(){for(let e=0,t=MM.steps.length;e<t;e++)MM.nextSlide(e)},setMinimalDisposition:function(e){let t=document.querySelectorAll("input[name='Enonces']");for(let s=0,i=t.length;s<i;s++)t[s].disabled=s<e,s===e&&MM.slidersNumber<=e+1&&(t[s].checked=!0,MM.setDispositionEnonce(e+1))},setDispositionEnonce:function(e){if(e=Number(e),MM.slidersNumber=e,document.getElementById("facetofaceOption").className="",1===e)document.getElementById("sddiv1").className="sddiv1",document.getElementById("sddiv2").className="hidden",document.getElementById("sddiv3").className="hidden",document.getElementById("sddiv4").className="hidden",document.getElementById("divisionsOption").className="hidden",MM.setDispositionDoubleEnonce("h"),MM.carts[0].target=[1],document.getElementById("facetofaceOption").className="hidden";else if(2===e){document.querySelectorAll("input[name='direction']")[0].checked?MM.setDispositionDoubleEnonce("h"):MM.setDispositionDoubleEnonce("v"),"y"===MM.faceToFace?document.getElementById("sddiv1").className="sddiv2 return":document.getElementById("sddiv1").className="sddiv2",document.getElementById("sddiv2").className="sddiv2",document.getElementById("sddiv3").className="hidden",document.getElementById("sddiv4").className="hidden",document.getElementById("divisionsOption").className="",e>MM.carts.length?MM.carts[0].target=[1,2]:(MM.carts[0].target=[1],MM.carts[1].target=[2])}else 3===e?("y"===MM.faceToFace?(document.getElementById("sddiv1").className="sddiv34 return",document.getElementById("sddiv2").className="sddiv34 return"):(document.getElementById("sddiv1").className="sddiv34",document.getElementById("sddiv2").className="sddiv34"),document.getElementById("sddiv3").className="sddiv34",document.getElementById("sddiv4").className="hidden",document.getElementById("divisionsOption").className="hidden",MM.setDispositionDoubleEnonce("h"),1===MM.carts.length?MM.carts[0].target=[1,2,3]:2===MM.carts.length?(MM.carts[0].target=[1,2],MM.carts[1].target=[3]):(MM.carts[0].target=[1],MM.carts[1].target=[2],MM.carts[2].target=[3])):4===e&&("y"===MM.faceToFace?(document.getElementById("sddiv1").className="sddiv34 return",document.getElementById("sddiv2").className="sddiv34 return"):(document.getElementById("sddiv1").className="sddiv34",document.getElementById("sddiv2").className="sddiv34"),document.getElementById("sddiv3").className="sddiv34",document.getElementById("sddiv4").className="sddiv34",document.getElementById("divisionsOption").className="hidden",MM.setDispositionDoubleEnonce("h"),1===MM.carts.length?MM.carts[0].target=[1,2,3,4]:2===MM.carts.length?(MM.carts[0].target=[1,2],MM.carts[1].target=[3,4]):3===MM.carts.length?(MM.carts[0].target=[1,2],MM.carts[1].target=[3],MM.carts[2].target=[4]):(MM.carts[0].target=[1],MM.carts[1].target=[2],MM.carts[2].target=[3],MM.carts[3].target=[4]));for(let e=0,t=MM.carts.length;e<t;e++)MM.carts[e].display()},setDispositionDoubleEnonce:function(e){"h"===e?(MM.slidersOrientation="h",document.getElementById("screen-division").className="",document.querySelector("input[name='direction'][value='h']").checked=!0):(MM.slidersOrientation="v",document.getElementById("screen-division").className="vertical",document.querySelector("input[name='direction'][value='v']").checked=!0)}};